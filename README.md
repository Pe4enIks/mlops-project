# MLOps Project

[![pre-commit](https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit)](https://github.com/pre-commit/pre-commit)
[![pre-commit.ci status](https://results.pre-commit.ci/badge/github/Pe4enIks/mlops-project/main.svg)](https://results.pre-commit.ci/latest/github/Pe4enIks/mlops-project/main)

## Постановка задачи
Дан набор изображений котов и собак, необходимо разработать систему классифицирующую объект на картинке на два класса - кот, собака.

## Подготовка виртуального окружения
- Создайте чистое виртуальное окружение любым удобным вам способом.
- Установите poetry по [гайду](https://python-poetry.org/docs/#installing-with-the-official-installer) из официальной документации.
- Установите необходимые пакеты с помощью команды `poetry install`.

## Запуск
- В качестве менеджера конфигурационных файлов используется [hydra](https://hydra.cc/docs/intro/). Конфигурационные параметры прописываются в конфигурационных файлах из папки [configs](/mlops-project/configs), либо прописываются как именованные аргументы во время запуска файлов [train.py](/mlops-project/train.py) и [infer.py](/mlops-project/infer.py). Например, если хотите использовать оптимизатор Adam вместо оптимизатора SGD, то используйте следующую команду: `python3 train.py optimizer=Adam`.
- Скачайте все необходимые файлы с помощью dvc из облака командой `dvc pull`.
- Для обучения запустите `python3 train.py` с правильными конфигурационными параметрами (описаны выше).
- Для инференса запустите `python3 infer.py` с правильными конфигурационными параметрами (описаны выше).

## Датасет
Датасет состоит из трех частей - обучающей, валидационной и тестовой.
Обучающая часть - 11250 изображений, 5625 котов и 5625 собак.
Валидационная часть - 2500 изображений, 1250 котов и 1250 собак.
Тестовая часть - 12494 изображений, 6251 котов и 6243 собак.

## Модель
Поддерживаются все модели семейства ResNet из модуля torchvision.models.
Последний fc слой заменяется новым, который имеет 2 выхода.
Производится дообучение модели с использованием весов данной модели, обученной на датасете ImageNet.

## Файлы
- train.py - обучение модели, сохранение весов в двух форматах: pickle и onnx, измерение и логирование метрик.
- infer.py - инференс модели с использованием onnxruntime.
- model.py - класс модели.
- dataset.py - класс датасета.

## Инструменты
- pytorch lightning.
- poetry.
- pre-commit.
- dvc.
- git.
- hydra.
- mlflow.
